---
title: "Loading and analysing GPS tracks with R"
author: "Robin Lovelace"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

Perhaps the most ubiquitous type of geographic information is the continuous stream of data produced by GPS devices.
Global Positioning System (GPS) devices are now in everything from watches to cars and, of course, smartphones.
This means that GPS datasets have the ability to track a large proportion of the world's population.
Although there are privacy concerns, when appropriately anonymized and aggregated, GPS datasets have the potential to help tackle the issues raised in Chapter [12](http://geocompr.robinlovelace.net/transport.html) of Gecomputation with R:
to design healthy transport systems in which walking and cycling overtake cars as the main travel modes.

## Loading GPS data

The standard format of GPS data is the [.gpx file](https://en.wikipedia.org/wiki/GPS_Exchange_Format).
GPS traces are vector datasets that are well-support by **sf** (see Chapter [2](https://geocompr.robinlovelace.net/spatial-class.html) of the book), so we'll use this package to process them:

```{r}
library(sf)
```

As with any dataset the first stage is to identify the source.
A great source of GPS data is OpenStreetMap (OSM).
We'll use publicly available .gpx files uploaded to OSM as the basis of this tutorial.^[
For saving your own GPS data, we recommend using an open source Android app such as [Orux](https://www.oruxmaps.com/cs/en/), [owntracks](https://github.com/owntracks/android) or [osmand](https://osmand.net/features/trip-recording-plugin).
These can then be transferred onto your computer and, if you want to support the community, uploaded to OSM.
]
For the purpose of this tutorial we will use a .gpx file uploaded to OSM, that represents travel to the [Institute for Geoinformatics, Universität Münster](https://www.uni-muenster.de/Geoinformatics/en/):

```{r}
u = "https://www.openstreetmap.org/trace/2886173/data"
download.file(url = u, destfile = "trace.gpx")
st_layers("trace.gpx")
```

The previous code code chunk downloads the trace from OSM and queries the 'layers' that can be imported (note there are 5, but only 'tracks' and 'track_points' are available).
The following code chunk imports and plots the 'tracks' layer, which is a MULTILINESTRING geometry in sf, and only 1 row of data:

```{r}
r = st_read("trace.gpx", layer = "tracks")
class(r)
st_geometry_type(r)
nrow(r)
plot(r$geometry)
```

Other than the geometry, this object has limited information about the route in the fields. 
The richest field is 'Description', which contains the following summary data:

```{r, results='asis'}
class(r$desc)
as.character(r$desc)
```

The data can also be imported as points, as follows:

```{r}
p = read_sf("trace.gpx", layer = "track_points")
plot(p)
```

