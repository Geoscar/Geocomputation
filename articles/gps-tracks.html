<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading and analyzing GPS tracks with R • geocompkg | metapackage for the book Gecomputation with R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Loading and analyzing GPS tracks with R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocompkg | metapackage for the book Gecomputation with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.75</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://geocompr.github.io/">Home</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/geocompr/geocompkg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Loading and analyzing GPS tracks with R</h1>
                        <h4 class="author">Robin Lovelace, Jakub Nowosad, Jannes Muenchow</h4>
            
            <h4 class="date">2019-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/geocompr/geocompkg/blob/master/vignettes/gps-tracks.Rmd"><code>vignettes/gps-tracks.Rmd</code></a></small>
      <div class="hidden name"><code>gps-tracks.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Perhaps the most ubiquitous type of geographic information is the continuous stream of data produced by GPS devices. Global Positioning System (GPS) devices are now in everything from watches to cars and, of course, smartphones. This means that GPS datasets have the ability to track a large proportion of the world’s population. Although there are privacy concerns, when appropriately anonymized and aggregated, GPS datasets have the potential to help tackle the issues raised in <a href="https://geocompr.robinlovelace.net/transport.html">the Transportation chapter</a> of <a href="https://geocompr.github.io/">the Geocomputation with R book</a>: to design healthy transport systems in which walking and cycling overtake cars as the main travel modes.</p>
</div>
<div id="loading-gps-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-gps-data" class="anchor"></a>Loading GPS data</h2>
<p>The standard format of GPS data is the <a href="https://en.wikipedia.org/wiki/GPS_Exchange_Format">.gpx file</a>. GPS traces are vector datasets that are well-support by <strong>sf</strong> (see Chapter <a href="https://geocompr.robinlovelace.net/spatial-class.html">2</a> of the book), so we’ll use this package to process them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)
<span class="co">#&gt; Linking to GEOS 3.5.1, GDAL 2.1.2, PROJ 4.9.3</span></code></pre></div>
<p>As with any dataset the first stage is to identify the source. A great source of GPS data is OpenStreetMap (OSM). We’ll use publicly available .gpx files uploaded to OSM as the basis of this tutorial.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> For the purpose of this tutorial we will use a .gpx file uploaded to OSM, that represents travel to the <a href="https://www.uni-muenster.de/Geoinformatics/en/">Institute for Geoinformatics, Universität Münster</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">u =<span class="st"> "https://www.openstreetmap.org/trace/2886173/data"</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="dt">url =</span> u, <span class="dt">destfile =</span> <span class="st">"trace.gpx"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_layers">st_layers</a></span>(<span class="st">"trace.gpx"</span>)
<span class="co">#&gt; Driver: GPX </span>
<span class="co">#&gt; Available layers:</span>
<span class="co">#&gt;     layer_name     geometry_type features fields</span>
<span class="co">#&gt; 1    waypoints             Point        0     23</span>
<span class="co">#&gt; 2       routes       Line String        0     12</span>
<span class="co">#&gt; 3       tracks Multi Line String        1     13</span>
<span class="co">#&gt; 4 route_points             Point        0     25</span>
<span class="co">#&gt; 5 track_points             Point      225     26</span></code></pre></div>
<p>The previous code chunk downloads the trace from OSM and queries the ‘layers’ that can be imported (note there are 5, but only ‘tracks’ and ‘track_points’ are available). The following code chunk imports and plots the ‘tracks’ layer, which is a MULTILINESTRING geometry in sf, and only 1 row of data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_read">st_read</a></span>(<span class="st">"trace.gpx"</span>, <span class="dt">layer =</span> <span class="st">"tracks"</span>)
<span class="co">#&gt; Reading layer `tracks' from data source `/home/rstudio/data/repos/geocompkg/vignettes/trace.gpx' using driver `GPX'</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 13 fields</span>
<span class="co">#&gt; geometry type:  MULTILINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 7.595836 ymin: 51.95356 xmax: 7.640715 ymax: 51.96967</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(r)
<span class="co">#&gt; [1] "sf"         "data.frame"</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry_type">st_geometry_type</a></span>(r)
<span class="co">#&gt; [1] MULTILINESTRING</span>
<span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(r)
<span class="co">#&gt; [1] 1</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(r<span class="op">$</span>geometry)</code></pre></div>
<p><img src="gps-tracks_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Other than the geometry, this object has limited information about the route in the fields. The richest field is ‘Description’, which contains the following summary data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(r<span class="op">$</span>desc)</code></pre></div>
<p>[1] “factor”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(r<span class="op">$</span>desc)</code></pre></div>
[1] “
<p>
Start time: 01/07/2019 10:03<br>Finish time: 01/07/2019 10:34<br>Distance: 5.1 km (00:30)<br>Moving time: 00:21<br>Average speed: 10.08 km/h<br>Avg. Speed Mov.: 14.07 km/h<br>Max. speed: 35.06 km/h<br>Minimum altitude: 32 m<br>Maximum altitude: 68 m<br>Ascent speed: 469.6 m/h<br>Descent speed: -889.1 m/h<br>Elevation gain: 139 m<br>Elevation loss: -113 m<br>Ascent time: 00:17<br>Descent time: 00:07<br></p>
<hr align='\"center\"' width='\"480\"' style='\"height:' width:>
<p>"</p>
<p>The data can also be imported as points, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_read">read_sf</a></span>(<span class="st">"trace.gpx"</span>, <span class="dt">layer =</span> <span class="st">"track_points"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(p)
<span class="co">#&gt; Warning: plotting the first 9 out of 26 attributes; use max.plot = 26 to</span>
<span class="co">#&gt; plot all</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span></code></pre></div>
<p><img src="gps-tracks_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="time-series" class="section level2">
<h2 class="hasAnchor">
<a href="#time-series" class="anchor"></a>Time series</h2>
<p>When did the track take place?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(p<span class="op">$</span>time)
<span class="co">#&gt;                  Min.               1st Qu.                Median </span>
<span class="co">#&gt; "2019-01-07 09:03:22" "2019-01-07 09:15:31" "2019-01-07 09:19:29" </span>
<span class="co">#&gt;                  Mean               3rd Qu.                  Max. </span>
<span class="co">#&gt; "2019-01-07 09:20:02" "2019-01-07 09:24:24" "2019-01-07 09:34:01"</span></code></pre></div>
<p>It started from just after 9:00 in the morning and ended just after 09:30. Let’s check if they happened at regular intervals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(p<span class="op">$</span>time, <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(p))</code></pre></div>
<p><img src="gps-tracks_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>And the temporal resolution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/difftime">difftime</a></span>(p<span class="op">$</span>time[<span class="dv">11</span>], p<span class="op">$</span>time[<span class="dv">10</span>])
<span class="co">#&gt; Time difference of 4 secs</span></code></pre></div>
</div>
<div id="converting-points-to-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-points-to-lines" class="anchor"></a>Converting points to lines</h2>
<p>The plot of points is useful, but it would be better to have a line representation <em>that contains the rich point-level data</em>. This can be done by converting the points to lines, as follows for the the first 2 points:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_coordinates">st_coordinates</a></span>(p)
l1 =<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_linestring</a></span>(c[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ])
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(l1)
lsf =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_set_geometry</a></span>(p[<span class="dv">2</span>, ], <span class="ot">NULL</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(l1))
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(p<span class="op">$</span>geometry[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">add =</span> T)</code></pre></div>
<p><img src="gps-tracks_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>For all points we can do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">points2line_trajectory =<span class="st"> </span><span class="cf">function</span>(p) {
  c =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_coordinates">st_coordinates</a></span>(p)
  i =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(p) <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)
  l =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(i, <span class="op">~</span><span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_linestring</a></span>(c[.x<span class="op">:</span>(.x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), ]))
  s =<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(i, <span class="cf">function</span>(x) {
    geosphere<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/geosphere/topics/distHaversine">distHaversine</a></span>(c[x, ], c[(x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), ]) <span class="op">/</span>
<span class="st">      </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(p<span class="op">$</span>time[x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>p<span class="op">$</span>time[x])
  }
  )
  lfc =<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(l)
  a =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(lfc)) <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="co"># sequence to subset</span>
  p_data =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_set_geometry</a></span>(p[a, ], <span class="ot">NULL</span>), s)
  sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>(p_data, <span class="dt">geometry =</span> lfc)
}</code></pre></div>
<p>Let’s test it out:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l =<span class="st"> </span><span class="kw">points2line_trajectory</span>(p)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(l)
<span class="co">#&gt; Warning: plotting the first 10 out of 27 attributes; use max.plot = 27 to</span>
<span class="co">#&gt; plot all</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span></code></pre></div>
<p><img src="gps-tracks_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>We now have lots more variables to play with and, unlike with the point dataset, the look good (and like traces) when plotted. Note that in the previous function definition we calculated speed. Plot the resulting ‘speed profile trace’ as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(l[<span class="st">"s"</span>], <span class="dt">lwd =</span> l<span class="op">$</span>s)</code></pre></div>
<p><img src="gps-tracks_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="further-resources" class="section level2">
<h2 class="hasAnchor">
<a href="#further-resources" class="anchor"></a>Further resources</h2>
<ul>
<li>Content on trajectories by Edzer Pebesma: <a href="http://edzer.github.io/astd/lec8.html" class="uri">http://edzer.github.io/astd/lec8.html</a>
</li>
<li>The <strong>trajectories</strong> package: <a href="https://cran.r-project.org/package=trajectories" class="uri">https://cran.r-project.org/package=trajectories</a>
</li>
<li>The <strong>trajr</strong> package: <a href="https://cran.rstudio.com/web/packages/trajr/vignettes/trajr-vignette.html" class="uri">https://cran.rstudio.com/web/packages/trajr/vignettes/trajr-vignette.html</a>
</li>
<li>The <strong>trackeR</strong> package: <a href="https://github.com/trackerproject/trackeR" class="uri">https://github.com/trackerproject/trackeR</a>
</li>
<li>The SpatioTemporal task view: <a href="https://cran.r-project.org/web/views/SpatioTemporal.html" class="uri">https://cran.r-project.org/web/views/SpatioTemporal.html</a>
</li>
</ul>
<!-- # Larger track datasets --><!-- 6 MB -->
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>For saving your own GPS data, we recommend using an open source Android apps such as <a href="https://www.oruxmaps.com/cs/en/">Orux</a>, <a href="https://github.com/owntracks/android">owntracks</a> or <a href="https://osmand.net/features/trip-recording-plugin">osmand</a>. These can then be transferred onto your computer and, if you want to support the community, uploaded to OSM.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#loading-gps-data">Loading GPS data</a></li>
      <li><a href="#time-series">Time series</a></li>
      <li><a href="#converting-points-to-lines">Converting points to lines</a></li>
      <li><a href="#further-resources">Further resources</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Jakub Nowosad, Jannes Muenchow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
