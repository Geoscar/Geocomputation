<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapter 3 â€¢ geocompkg | metapackage for the book Gecomputation with R</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 3">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocompkg | metapackage for the book Gecomputation with R</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.66</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://geocompr.github.io/">Home</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/geocompr/geocompkg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Chapter 3</h1>
                        <h4 class="author">Robin Lovelace, Jakub Nowosad, Jannes Muenchow</h4>
            
            <h4 class="date">2018-08-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/geocompr/geocompkg/blob/master/vignettes/solutions03.Rmd"><code>vignettes/solutions03.Rmd</code></a></small>
      <div class="hidden name"><code>solutions03.Rmd</code></div>

    </div>

    
    
<div id="prerequisites" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>The solutions assume the following packages are attached (other packages will be attached when needed):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(spData)</code></pre></div>
</div>
<div id="chapter-3" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-3" class="anchor"></a>Chapter 3</h1>
<!-- Attribute subsetting -->
<ol style="list-style-type: decimal">
<li>Select only the <code>NAME</code> column in <code>us_states</code> and create a new object called <code>us_states_name</code>. What is the class of the new object? <!--why there is a "sf" part? -->
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_name =<span class="st"> </span>us_states <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(NAME)
<span class="kw">class</span>(us_states_name)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Select columns which contain information about a total population. Think about as many ways as possible to do it. Hint: try to use helper functions, such as <code>contains</code> or <code>starts_with</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(total_pop_<span class="dv">10</span>, total_pop_<span class="dv">15</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">"total_pop"</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">"total_pop"</span>))</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Find all states that:</li>
</ol>
<ul>
<li>Belongs to the Midwest region</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(total_pop_<span class="dv">15</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">750000</span>)</code></pre></div>
<ul>
<li>Had a total population in 2015 lower than 750,000 residents</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(total_pop_<span class="dv">15</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">750000</span>)</code></pre></div>
<ul>
<li>Belongs to the West region, had an area smaller than 250,000 km<sup>2</sup> and total population in 2015 larger than 5,000,000 residents</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "West"</span>, AREA <span class="op">&lt;</span><span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">250000</span>, km<span class="op">^</span><span class="dv">2</span>),total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">5000000</span>)
<span class="co"># or</span>
us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "West"</span>, <span class="kw">as.numeric</span>(AREA) <span class="op">&lt;</span><span class="st"> </span><span class="dv">250000</span>,total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">5000000</span>)</code></pre></div>
<ul>
<li>Belongs to the South region, had an area larger than 150,000 km<sup>2</sup> or total population in 2015 larger than 7,000,000 residents</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "South"</span>, AREA <span class="op">&gt;</span><span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">150000</span>, km<span class="op">^</span><span class="dv">2</span>), total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">7000000</span>)
<span class="co"># or</span>
us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "South"</span>, <span class="kw">as.numeric</span>(AREA) <span class="op">&gt;</span><span class="st"> </span><span class="dv">150000</span>, total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">7000000</span>)</code></pre></div>
<!-- 4. Exercises about additional select and filter helper functions (one_of; between, is.na, near, etc.) -->
<!-- Attribute aggregation -->
<ol start="4" style="list-style-type: decimal">
<li>What was the total population in 2015 in the <code>us_states</code> database? What was the minimum and maximum total population in 2015?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">total_pop =</span> <span class="kw">sum</span>(total_pop_<span class="dv">15</span>),
                        <span class="dt">min_pop =</span> <span class="kw">min</span>(total_pop_<span class="dv">15</span>),
                        <span class="dt">max_pop =</span> <span class="kw">max</span>(total_pop_<span class="dv">15</span>))</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>How many states are in each region?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">nr_of_states =</span> <span class="kw">n</span>())</code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>What was the minimum and maximum total population in 2015 in each region? What was the total population in 2015 in each region?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_pop =</span> <span class="kw">min</span>(total_pop_<span class="dv">15</span>),
            <span class="dt">max_pop =</span> <span class="kw">max</span>(total_pop_<span class="dv">15</span>),
            <span class="dt">tot_pop =</span> <span class="kw">sum</span>(total_pop_<span class="dv">15</span>))</code></pre></div>
<!-- Attribute joining -->
<ol start="7" style="list-style-type: decimal">
<li>Add variables from <code>us_states_df</code> to <code>us_states</code> and create a new object called <code>us_states_stats</code>. What is the best function to do it? Which variable is the key in the both datasets? What is the class of a new object?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_stats =<span class="st"> </span>us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(us_states_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"NAME"</span> =<span class="st"> "state"</span>))
<span class="kw">class</span>(us_states_stats)</code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>
<code>us_states_df</code> has two more variables than <code>us_states</code>. How you can find them?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(us_states, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"state"</span> =<span class="st"> "NAME"</span>))</code></pre></div>
<!-- Attribute creation -->
<ol start="9" style="list-style-type: decimal">
<li>What was the population density in 2015 in each state? What was the population density in 2010 in each state?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states2 =<span class="st"> </span>us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop_dens_15 =</span> total_pop_<span class="dv">15</span><span class="op">/</span>AREA,
         <span class="dt">pop_dens_10 =</span> total_pop_<span class="dv">10</span><span class="op">/</span>AREA)</code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>How much the population density changed between 2010 and 2015 in each state? Calculate the change in percentages.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop_dens_diff_10_15 =</span> pop_dens_<span class="dv">15</span> <span class="op">-</span><span class="st"> </span>pop_dens_<span class="dv">10</span>,
         <span class="dt">pop_dens_diff_10_15p =</span> (pop_dens_diff_10_<span class="dv">15</span><span class="op">/</span>pop_dens_<span class="dv">15</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Change the columns names in <code>us_states</code> to lowercase. Try to use two helper functions - <code>tolower()</code> and <code>colnames()</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">set_names</span>(<span class="kw">tolower</span>(<span class="kw">colnames</span>(.)))</code></pre></div>
<!-- Mixed exercises -->
<!-- combination of use of select, mutate, group_by, summarize, etc  -->
<ol start="12" style="list-style-type: decimal">
<li>Using <code>us_states</code> and <code>us_states_df</code> create a new object called <code>us_states_sel</code>. The new object should have only two variables - <code>median_income_15</code> and <code>geometry</code>. Change the name of the <code>median_income_15</code> column to <code>Income</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(us_states_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"NAME"</span> =<span class="st"> "state"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">Income =</span> median_income_<span class="dv">15</span>)</code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li>Calculate the change in median income between 2010 and 2015 for each state. What was the minimum, average and maximum median income in 2015 for each region? What is the region with the largest increase of the median income?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(us_states_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"NAME"</span> =<span class="st"> "state"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">income_change =</span> median_income_<span class="dv">15</span> <span class="op">-</span><span class="st"> </span>median_income_<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_income_change =</span> <span class="kw">min</span>(income_change),
            <span class="dt">mean_income_change =</span> <span class="kw">mean</span>(income_change),
            <span class="dt">max_income_change =</span> <span class="kw">max</span>(income_change)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(mean_income_change <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(mean_income_change)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.character</span>()</code></pre></div>
<ol start="14" style="list-style-type: decimal">
<li>Create a raster from scratch with nine rows and columns and a resolution of 0.5 decimal degrees (WGS84). Fill it with random numbers. Extract the values of the four corner cells.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
r =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="dt">nrow =</span> <span class="dv">9</span>, <span class="dt">ncol =</span> <span class="dv">9</span>, <span class="dt">res =</span> <span class="fl">0.5</span>, <span class="dt">xmn =</span> <span class="dv">0</span>, <span class="dt">xmx =</span> <span class="fl">4.5</span>,
           <span class="dt">ymn =</span> <span class="dv">0</span>, <span class="dt">ymx =</span> <span class="fl">4.5</span>, <span class="dt">vals =</span> <span class="kw">rnorm</span>(<span class="dv">81</span>))
<span class="co"># using cell IDs</span>
r[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">81</span> <span class="op">-</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">81</span>)]
<span class="co"># using indexing</span>
r[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(r)), <span class="kw">c</span>(<span class="dv">1</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(r))]
<span class="co"># corresponds to [1, 1], [1, 9], [9, 1], [9, 9]</span></code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li>What is the most common class of our example raster <code>grain</code> (hint: <code><a href="http://www.rdocumentation.org/packages/raster/topics/modal">modal()</a></code>)?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grain_size =<span class="st"> </span><span class="kw">c</span>(<span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>)
grain =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">ncol =</span> <span class="dv">6</span>, <span class="dt">res =</span> <span class="fl">0.5</span>, 
               <span class="dt">xmn =</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="dt">xmx =</span> <span class="fl">1.5</span>, <span class="dt">ymn =</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="dt">ymx =</span> <span class="fl">1.5</span>,
               <span class="dt">vals =</span> <span class="kw">factor</span>(<span class="kw">sample</span>(grain_size, <span class="dv">36</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), 
                             <span class="dt">levels =</span> grain_size))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/cellStats">cellStats</a></span>(grain, modal) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/factor">factorValues</a></span>(grain, .)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/factor">factorValues</a></span>(grain, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/modal">modal</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getValues">values</a></span>(grain)))</code></pre></div>
<ol start="16" style="list-style-type: decimal">
<li>Plot the histogram and the boxplot of the <code>data(dem, package = "RQGIS")</code> raster.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(dem, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/hist">hist</a></span>(dem)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/boxplot">boxplot</a></span>(dem)</code></pre></div>
<ol start="17" style="list-style-type: decimal">
<li>Now attach also <code>data(ndvi, package = "RQGIS")</code>. Create a raster stack using <code>dem</code> and <code>ndvi</code>, and make a <code><a href="http://www.rdocumentation.org/packages/raster/topics/pairs">pairs()</a></code> plot</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ndvi, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
s =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/stack">stack</a></span>(dem, ndvi)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/pairs">pairs</a></span>(s)</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#chapter-3">Chapter 3</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Jakub Nowosad, Jannes Muenchow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
