<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Subsetting Extended • geocompkg | metapackage for the book Gecomputation with R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Subsetting Extended">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocompkg | metapackage for the book Gecomputation with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.75</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://geocompr.github.io/">Home</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/geocompr/geocompkg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="subsetting_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="subsetting_files/jquery-1.12.4/jquery.min.js"></script><link href="subsetting_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="subsetting_files/leaflet-1.3.1/leaflet.js"></script><link href="subsetting_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="subsetting_files/Proj4Leaflet-1.0.1/proj4-compressed.js"></script><script src="subsetting_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="subsetting_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="subsetting_files/leaflet-binding-2.0.2/leaflet.js"></script><script src="subsetting_files/leaflet-providers-1.1.17/leaflet-providers.js"></script><script src="subsetting_files/leaflet-providers-plugin-2.0.2/leaflet-providers-plugin.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Spatial Subsetting Extended</h1>
                        <h4 class="author">Robin Lovelace, Jakub Nowosad, Jannes Muenchow</h4>
            
            <h4 class="date">2019-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/geocompr/geocompkg/blob/master/vignettes/subsetting.Rmd"><code>vignettes/subsetting.Rmd</code></a></small>
      <div class="hidden name"><code>subsetting.Rmd</code></div>

    </div>

    
    
<p>This vignette provides some further detail on the vector attribute subsetting section (see <a href="https://geocompr.robinlovelace.net/attr.html#vector-attribute-subsetting" class="uri">https://geocompr.robinlovelace.net/attr.html#vector-attribute-subsetting</a> ) and the spatial subsetting section (see <a href="https://geocompr.robinlovelace.net/spatial-operations.html#spatial-subsetting" class="uri">https://geocompr.robinlovelace.net/spatial-operations.html#spatial-subsetting</a> ) of <a href="https://geocompr.github.io/">the Geocomputation with R book</a>. It goal is to demonstrate some subtleties of spatial subsetting of <code>sf</code> objects using base R and <strong>tidyverse</strong> methods.</p>
<p>The starting point is to attach necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(spData)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a></code></pre></div>
<p>And subsetting canterbury and <code>nz_height</code> features in the region:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">canterbury =<span class="st"> </span>nz <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(Name <span class="op">==</span><span class="st"> "Canterbury"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">canterbury_height =<span class="st"> </span>nz_height[canterbury, ]</a></code></pre></div>
<div id="subsetting-with-intermediary-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-with-intermediary-objects" class="anchor"></a>Subsetting with intermediary objects</h2>
<p>We can see how to get a list representation for subsetting:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">sel_sgbp =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_intersects</a></span>(<span class="dt">x =</span> nz_height, <span class="dt">y =</span> canterbury)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(sel_sgbp)</a></code></pre></div>
<pre><code>## [1] "sgbp"</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">sel_logical =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lengths">lengths</a></span>(sel_sgbp) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>In the above code chunk, an object of class <code>sgbp</code> is created and then converted into a logical vector <code>sel_logical</code>. Values of TRUE in <code>sel_logical</code> represents points from <code>nz_height</code> that intersects with the <code>canterbury</code> polygon. In other words, it returns elevation points located in the Canterbury region.</p>
<p>Use the result using base R:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">canterbury_height2 =<span class="st"> </span>nz_height[sel_logical, ]</a></code></pre></div>
<p>And use the result with the tidyverse:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">canterbury_height3 =<span class="st"> </span>nz_height <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(sel_logical)</a></code></pre></div>
</div>
<div id="dplyr-changes-row-names" class="section level2">
<h2 class="hasAnchor">
<a href="#dplyr-changes-row-names" class="anchor"></a><strong>dplyr</strong> changes row names</h2>
<p>We can test whether the subsetted objects are identical as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(<span class="dt">x =</span> canterbury_height, <span class="dt">y =</span> canterbury_height2)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(<span class="dt">x =</span> canterbury_height, <span class="dt">y =</span> canterbury_height3)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>What is different about <code>canterbury_height3</code>? The only difference is that <code><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter()</a></code> changed the row names:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/row.names">row.names</a></span>(canterbury_height)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] "5" "6" "7"</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/row.names">row.names</a></span>(canterbury_height3)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] "1" "2" "3"</code></pre>
<p>If the row names are re-set, the objects become identical:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(canterbury_height3, <span class="st">"row.names"</span>) =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(<span class="dt">x =</span> canterbury_height, <span class="st">"row.names"</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(canterbury_height, canterbury_height3)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="rmdnote">
<p>
This discarding of row names is not something that is specific to spatial data, as illustrated in the code chunk below. <strong>dplyr</strong> discards row names by design. For further discussion of this decision, and some controversy, see the (closed) issue <a href="https://github.com/tidyverse/dplyr/issues/366">#366</a> in the package’s issue tracker.
</p>
</div>
</div>
<div id="dense-matrices-from-spatial-predicates" class="section level2">
<h2 class="hasAnchor">
<a href="#dense-matrices-from-spatial-predicates" class="anchor"></a>Dense matrices from spatial predicates</h2>
<p>In the code below a dense matrix is created. <code>sel</code> is not, as one might imagine, a <code>logical</code> <code>vector</code> (although it behaves as one as it only has one column) but a <code>logical</code> <code>matrix</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">sel =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_intersects</a></span>(nz_height, canterbury, <span class="dt">sparse =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(sel)</a></code></pre></div>
<pre><code>## [1] "matrix"</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/typeof">typeof</a></span>(sel)</a></code></pre></div>
<pre><code>## [1] "logical"</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(sel)</a></code></pre></div>
<pre><code>## [1] 101   1</code></pre>
<p>The dimensions of <code>sel</code> (returned by the base R command <code><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim()</a></code>) show one row per feature in the target object (<code>nz_height</code>) and a column per feature in the subsetting object (<code>canterbury</code>). The general pattern here is that <code>sel[i, j]</code> is <code>TRUE</code> if the i<sup>th</sup> feature in the target object intersects with the j<sup>th</sup> feature in the subsetting object. If there is more than one feature in <code>y</code> the resulting selection <code>matrix</code> must be converted into a <code>vector</code> before it is used for subsetting, e.g. with <code>rowSums(sel_matrix) &gt; 0</code>. Another solution is to convert the default sparse matrix (<code>list</code>) output from <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_intersects()</a></code> to a <code>logical</code> vector using the function <code><a href="https://www.rdocumentation.org/packages/base/topics/lengths">lengths()</a></code>. This approach to spatial subsetting, used internally by <strong>sf</strong> (see the source code of <code>sf:::`[.sf`</code>), is illustrated in the code chunk below:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">co =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(nz, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Canter|Otag"</span>, Name))</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">sel_sparse =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_intersects</a></span>(nz_height, co)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">sel_vector =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lengths">lengths</a></span>(sel_sparse) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">heights_co =<span class="st"> </span>nz_height[sel_vector, ]</a></code></pre></div>
<p>The above code chunk results in an object, <code>heights_co</code>, that represents the high points that intersect with either Canterbury <em>or</em> Otago region (hence the object name <code>co</code>). It did this in four stages:</p>
<ol style="list-style-type: decimal">
<li>Subset the regions of <code>nz</code> containing “Canter” or “Otago” in their names. This was done using the pattern matching function <code><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl()</a></code> in combination with the <code>|</code> character, which means ‘or’, resulting in the subsetting object <code>co</code>.</li>
<li>Create a sparse geometry binary predicate <code>sgbp</code> object, a list representing which features of <code>nz_height</code> intersect with the regions in <code>co</code>.</li>
<li>Convert the selection list into a <code>logical</code> ‘selection vector’. <code><a href="https://www.rdocumentation.org/packages/base/topics/lengths">lengths()</a></code> finds the features in <code>nz_height</code> matching <em>any</em> features in <code>co</code>.</li>
<li>Use the result to subset <code>nz_heights</code>, creating a new object <code>heights_co</code>.</li>
</ol>
</div>
<div id="more-on-subsetting-in-base-r" class="section level2">
<h2 class="hasAnchor">
<a href="#more-on-subsetting-in-base-r" class="anchor"></a>More on subsetting in base R</h2>
<p>Another spatial subsetting example will use an object representing the countries of Africa, created using attribute subsetting as follows:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">africa_wgs =<span class="st"> </span>world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(continent <span class="op">==</span><span class="st"> "Africa"</span>)</a></code></pre></div>
<p>To further prepare the input data, we will reproject the data to the coordinate reference system (CRS) 32630, its EPSG code (explained in <a href="https://geocompr.robinlovelace.net/reproj-geo-data.html">Chapter 6</a>):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">africa =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(africa_wgs, <span class="dt">crs =</span> <span class="dv">32630</span>)</a></code></pre></div>
<p>We can also use the <code>[</code> operator for <em>Spatial</em> subsetting. The difference is that we use <em>another spatial object</em> inside the square brackets instead of an <code>integer</code> or <code>logical</code> vector. This is a concise and consistent syntax, as shown in the next code chunk. Let’s test it with a hypothetical scenario: we want to subset all countries within 2000 km of the point where the equator (where latitude = 0 degrees) intersects the prime meridian (longitude = 0 degrees), as illustrated in the next figure. The subsetting object is created below. Note that this must have the same CRS as the target object (set with the <code>crs</code> argument):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">center_wgs =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>(<span class="dt">geometry =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_point</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)), <span class="dt">crs =</span> <span class="dv">4326</span>))</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">center =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(center_wgs, <span class="dv">32630</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">buff =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_buffer</a></span>(center, <span class="dt">dist =</span> <span class="fl">2e6</span>)</a></code></pre></div>
<div class="figure">
<img src="https://github.com/Robinlovelace/geocompr/raw/master/figures/globe.png" alt="Subsetting scenario: which countries intersect with a circle of 2000 km in radius located at zero degrees longitude and zero degrees latitude? Figure created with the globe package."><p class="caption">Subsetting scenario: which countries intersect with a circle of 2000 km in radius located at zero degrees longitude and zero degrees latitude? Figure created with the <strong><a href="https://cran.r-project.org/package=globe">globe</a></strong> package.</p>
</div>
<p>The data to be subset, or ‘target layer’, is the <code>africa</code> object created above, which has a projected CRS (<code>32630</code>). Subsequently, spatial subsetting can be done with a single, concise command:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">africa_buf =<span class="st"> </span>africa[buff, ]</a></code></pre></div>
<p><strong>Sidenote:</strong> If we were using geographic (‘lon/lat’) data the previous command would have emitted a message warning about assuming <code>planar coordinates</code>. This is because spatial operations (especially distance and area calculations) cannot be assumed to be accurate in a geographic (longitude/latitude) CRS. In this case one could justify the use of a lon/lat CRS: the data is close to the equator where there is least distortion caused by the curvature of the earth. It is good practice to reproject spatial datasets before performing spatial operations on them.</p>
<p>The spatial subsetting clearly worked: only countries intersecting with the giant circle are returned (see the figure below):</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(africa_buf[<span class="st">"pop"</span>], <span class="dt">reset =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(buff, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<div id="htmlwidget-5d68874c2c01a8496b31" style="width:700px;height:432.632880098888px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-5d68874c2c01a8496b31">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenMapSurfer.Grayscale",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[29.3399975929003,29.5199866065729,29.4199927100882,29.62003217949,30.1999967791017,30.7400154965518,30.7400097314221,30.3460860531908,29.0029122250605,28.7348665707625,28.4498710466728,28.6736816749289,28.4960697771418,28.3722530453704,28.6424174333924,29.3415478858691,29.6160014177712,29.6996138852195,28.9342859229768,28.523561639121,28.15510867688,27.3887988624238,27.1644197934125,26.5530875993996,25.7523096046047,25.4181181169732,24.783169793403,24.314516228948,24.257155389104,23.9122152035557,23.4567908057674,22.8373454118847,22.4027982927424,22.1552681820643,22.2087532894864,21.8751819190423,21.8018013851879,21.949130893652,21.7464559262033,21.7281107927397,20.5147481625265,20.6018229509383,20.0916215349206,20.0377230160402,19.4175024756732,19.1666133968961,19.0167517432497,18.4641756527527,18.134221632569,17.4729700049622,17.0899959652472,16.8601908708452,16.5731799658961,16.326528354567,13.3755973649719,13.024869419007,12.7351713395787,12.3224316748635,12.1823368669202,12.4366882666609,12.4680041846297,12.6316117692658,12.9955172054652,13.258240187237,13.6002348161447,14.1449560889333,14.2090348649752,14.5826037940132,15.1709916520884,15.7535400733147,16.0062895036543,15.9728031755292,16.4070919125101,16.8653068376421,17.5237162614729,17.63864464689,17.6635526872547,17.8265401547032,17.7741919287916,17.8988354834796,18.0942757504074,18.3937923519711,18.4530652198099,18.5429822119978,18.9323124528848,19.4677836442931,20.2906791521089,20.9275911801063,21.65912275563,22.4051237321955,22.7041235694363,22.8414795264681,23.2972139828501,24.4105310401463,24.8050289242624,25.1288334490033,25.2787984555143,25.6504553565575,26.4027608578625,27.0440653826047,27.3742261085175,27.9799772478428,28.4289937680269,28.6966776872988,29.1590784034465,29.715995314256,29.9535001970695,30.8338524217154,30.8338598975938,30.77334679538,31.1741492042358,30.852670118948,30.4685075212903,30.0861535987627,29.8757788429024,29.8195032081366,29.5878377621722,29.5794661801409,29.2918868344366,29.2548348324833,29.1174788754515,29.0249263852168,29.2763839047491,29.3399975929003],"lat":[-4.49998341229409,-5.41997893638631,-5.93999887453943,-6.52001515058342,-7.07998097089816,-8.34000741947091,-8.34000593035372,-8.23825652428822,-8.40703175215347,-8.52655934004457,-9.16491830814609,-9.60592498132493,-10.789883721564,-11.7936467424014,-11.9715686987823,-12.3607439103724,-12.1788945451373,-13.2572266577718,-13.2489584286051,-12.6986044246967,-12.2724805640179,-12.1327474911007,-11.6087484676611,-11.9244397925321,-11.7849651017764,-11.33093596766,-11.238693536019,-11.2628264298993,-10.9519926896637,-10.9268262671375,-10.8678634578925,-11.0176217586743,-10.9930754533357,-11.0848011206538,-9.89479623783651,-9.52370777754856,-8.90870655684298,-8.30590097415828,-7.92008473066715,-7.2908724910813,-7.29960580813863,-6.93931772219968,-6.94309010175699,-7.11636117923164,-7.1554285620443,-7.73818368899975,-7.98824594486013,-7.84701425540644,-7.98767750410492,-8.0685511206417,-7.54568897871252,-7.22229786542998,-6.62264454511509,-5.87747039146627,-5.86424122479955,-5.98438892987816,-5.9656820613885,-6.10009246177966,-5.78993051516384,-5.68430388755925,-5.248361504745,-4.99127125409294,-4.78110320396188,-4.88295745200917,-4.50013844159097,-4.51000864015872,-4.7930921362536,-4.97023894615014,-4.3435071753143,-3.8551648901561,-3.53513274497253,-2.71239226645361,-1.74092701579868,-1.22581633871329,-0.743830254726987,-0.424831638189247,-0.0580839982138172,0.288923244626105,0.855658677571085,1.74183197672828,2.36572154378806,2.90044342692822,3.50438589112335,4.20178518311832,4.70950613038598,5.03152781821278,4.69167776124529,4.32278554932974,4.22434194581372,4.02916006104732,4.63305084881016,4.71012624757349,4.60969310141422,5.10878408448913,4.89724660890235,4.92724477784779,5.17040822999719,5.25608775473712,5.15087453859087,5.12785268800484,5.23394440350006,4.40841339763737,4.28715464926449,4.45507721599694,4.38926727947323,4.60080475506015,4.17369904216768,3.50917160422246,3.50916596111034,2.33988332764213,2.20446523682126,1.84939647054381,1.58380544677971,1.06231273030629,0.597379868976361,-0.205310153813371,-0.587405694179381,-1.34131316488563,-1.62005584066799,-2.21510995850891,-2.29221119548838,-2.83925790773016,-3.29390715903406,-4.49998341229409]}]],[[{"lng":[23.8376600000001,23.8868900000001,23.0245900000001,22.5679500000001,22.30351,22.51202,22.18329,22.29658,22.03759,21.93681,22.28801,22.49762,22.50869,22.8762199999999,22.8641654802442,22.2311291846688,21.7238216488595,21.0008683610962,20.0596854997643,19.094008009526,18.8120097185093,18.9110217627805,18.3895548845232,17.9649296403809,16.7059883968863,16.4561845231873,16.2905615576919,16.1062317237067,15.2794604834691,15.4360917497457,15.1208655127653,14.9799955583377,14.5444665869818,13.954218377344,14.171466098699,14.6272005550811,14.9093538753947,15.4678727556052,14.923564894275,14.9601518083376,14.89336,14.4957873877628,14.5957812842476,13.9544767595056,13.9566988460941,13.5403935075508,13.97217,15.2477311540418,15.3004411149797,15.6857405941478,15.9032466976643,15.4871480648501,15.4710600000001,15.0968876481819,14.8513,15.8608500000001,19.8492600000001,23.8376600000001],"lat":[19.5804700000001,15.61084,15.6807200000001,14.9442900000001,14.32682,14.09318,13.78648,13.3723199999999,12.95546,12.5881800000001,12.6460499999999,12.2602400000001,11.67936,11.3846100000001,11.1423951278075,10.9718887394606,10.567055568886,9.47598521569151,9.01270600019485,9.07484691002584,8.9829145369786,8.63089468020635,8.28130361575182,7.89091400800299,7.50832754152998,7.73477366783297,7.75430735923942,7.49708791750646,7.42192454673797,7.69281240481189,8.38215017336944,8.79610423424347,8.96586131432227,9.54949494062669,10.0213782820999,9.92091929772454,9.99212942142273,9.98233673750354,10.8913251815175,11.5555740421972,12.21905,12.8593962671373,13.3304269474779,13.3534487980638,13.9966911890169,14.3671336939012,15.6843700000001,16.6273058130508,17.927949937405,19.9571800806424,20.3876189234175,20.7304145370256,21.0484500000001,21.3085187850749,22.8629500000001,23.40972,21.4950900000001,19.5804700000001]}]],[[{"lng":[-16.7137288070235,-17.1261067367126,-17.6250426904907,-17.1851728988222,-16.7007063460859,-16.4630981104079,-16.1206900700419,-15.6236661442587,-15.1357372705588,-14.577347581429,-14.0995214502422,-13.4357376774531,-12.8306583317475,-12.1707502913803,-12.1248874577213,-11.9277160303116,-11.5533977930054,-11.4678991357785,-11.5139428369506,-11.6583009505579,-12.2035648258856,-12.2785990055734,-12.4990506657306,-13.2178181624782,-13.7004760400843,-15.548476935274,-15.8165742660043,-16.1477168441306,-16.6774519515546,-16.8415246240813,-15.9312959456922,-15.691000535535,-15.5118125065629,-15.1411632959495,-14.7121972314946,-14.2777017887846,-13.8449633447724,-14.0469923568175,-14.3767138330558,-14.6870308089685,-15.0817353988138,-15.3987703109245,-15.6245963200399,-16.7137288070235],"lat":[13.5949586043799,14.3735157332892,14.7295405135641,14.9194772404529,15.6215274113541,16.1350361190385,16.4556625431934,16.3693370630498,16.5872824162408,16.5982636581028,16.3043022730105,16.0393830428662,15.3036915145429,14.6168342147355,13.9947274845898,13.4220751001474,13.1412136906411,12.754518947801,12.4429875757294,12.3865827498828,12.4656476912894,12.3544400089973,12.3320899520311,12.575873521368,12.5861829696102,12.6281700708473,12.5155671248833,12.5477615422012,12.3848515894011,13.1513939478026,13.1302841252113,13.2703530949385,13.2785696476729,13.5095116235852,13.2982066919438,13.2805850285322,13.505041612192,13.7940678980004,13.6256802433774,13.6303569604998,13.876491807506,13.8603687606309,13.6235873478696,13.5949586043799]}]],[[{"lng":[-11.5139428369506,-11.4678991357785,-11.5533977930054,-11.9277160303116,-12.1248874577213,-12.1707502913803,-11.8342075260795,-11.6660782536179,-11.3490950179395,-10.6507913883794,-10.0868464827782,-9.70025509280271,-9.55023840985939,-5.53774430990845,-5.31527726889193,-5.48852250815044,-5.97112870932425,-6.45378658693033,-4.92333736817423,-1.55005489745761,1.82322757325903,2.06099083823392,2.68358849448643,3.1466610042539,3.1581331722227,4.26741946780004,4.2702099951438,3.72342166506348,3.63825890464648,2.74999270998148,1.38552819174686,1.01578331869848,0.374892205414682,-0.266257290030581,-0.515854458000348,-1.06636349120566,-2.00103512206877,-2.19182451009039,-2.96769446452058,-3.10370683431276,-3.52280270019986,-4.00639075358723,-4.28040503581488,-4.4271661035238,-5.22094194174312,-5.19784257650865,-5.47056494792901,-5.40434159994697,-5.81692623536529,-6.05045203289227,-6.20522294760643,-6.49396501303727,-6.66646094402755,-6.85050655763506,-7.62275916180481,-7.89958980959237,-8.02994361004862,-8.33537716310974,-8.28235714357828,-8.40731075686003,-8.62032101076713,-8.58130530438677,-8.37630489748491,-8.78609900555946,-8.90526485842453,-9.12747351727958,-9.32761633954601,-9.56791174970321,-9.89099280439201,-10.1652137923488,-10.5932238428063,-10.8708296370782,-11.0365559554383,-11.2975736149445,-11.4561685856483,-11.5139428369506],"lat":[12.4429875757294,12.754518947801,13.1412136906411,13.4220751001474,13.9947274845898,14.6168342147355,14.7990969914289,15.3882083195563,15.4112560083585,15.1327458765214,15.3304857446863,15.2641073674074,15.4864968937754,15.5016897648693,16.2018537459918,16.325102037008,20.6408334416476,24.9565906845034,24.974574082941,22.7926659204974,20.610809434486,20.1422333846795,19.8562301701601,19.6935785995214,19.05736420336,19.155265204337,16.8522274846012,16.1842837590126,15.5681198185805,15.4095248478767,15.3235611027592,14.968182277888,14.9289081893461,14.9243089868721,15.1161577417557,14.9738150090078,14.5590082870009,14.2464175480674,13.7981503361515,13.5412667912286,13.3376616479986,13.4724854598481,13.2284435083497,12.5426455754043,11.7138589543072,11.3751457788501,10.951269842976,10.3707368026091,10.2225546330122,10.0963607853554,10.5240607772191,10.4113028019583,10.4308106551484,10.1389938419962,10.1472362329468,10.2973821069708,10.2065349390017,10.4948119165419,10.7925973576238,10.9092569035228,10.8108908146552,11.1362456323648,11.3936459416106,11.8125609399847,12.0883580591264,12.3080604110153,12.3342862004035,12.1942430688925,12.060478623905,11.8440835636827,11.923975328006,12.1778874780721,12.2112446151165,12.0779710962358,12.0768342147253,12.4429875757294]}]],[[{"lng":[-17.0634232243426,-16.845193650774,-12.9291019352635,-13.1187544417747,-12.8742215641696,-11.9372244938533,-11.9694189111712,-8.6872936670174,-8.68439978680905,-4.92333736817423,-6.45378658693033,-5.97112870932425,-5.48852250815044,-5.31527726889193,-5.53774430990845,-9.55023840985939,-9.70025509280271,-10.0868464827782,-10.6507913883794,-11.3490950179395,-11.6660782536179,-11.8342075260795,-12.1707502913803,-12.8306583317475,-13.4357376774531,-14.0995214502422,-14.577347581429,-15.1357372705588,-15.6236661442587,-16.1206900700419,-16.4630981104079,-16.5497078109291,-16.2705517236884,-16.1463474186749,-16.2568833073472,-16.3776511296133,-16.2778381006415,-16.5363236149655,-17.0634232243426],"lat":[20.9997521021308,21.3333234725749,21.3270706242676,22.7712202010963,23.2848322616452,23.3745942245362,25.9333527694683,25.8810562199889,27.395744126896,24.974574082941,24.9565906845034,20.6408334416476,16.325102037008,16.2018537459918,15.5016897648693,15.4864968937754,15.2641073674074,15.3304857446863,15.1327458765214,15.4112560083585,15.3882083195563,14.7990969914289,14.6168342147355,15.3036915145429,16.0393830428662,16.3043022730105,16.5982636581028,16.5872824162408,16.3693370630498,16.4556625431934,16.1350361190385,16.673892116762,17.1669627954749,18.1084815536167,19.0967158065503,19.593817246982,20.0925206568147,20.5678663192515,20.9997521021308]}]],[[{"lng":[2.69170169435625,1.86524051271232,1.61895063640924,1.66447757325838,1.46304284018467,1.42506066245014,1.07779503744874,0.772335646171484,0.899563022474068,1.24346967937649,1.44717817547107,1.93598554851988,2.15447350424992,2.49016360841793,2.84864301922658,3.61118045412556,3.57221642417747,3.79711225751171,3.6000700211828,3.70543826662592,3.2203515967021,2.91230838381026,2.72379275880951,2.74906253420022,2.69170169435625],"lat":[6.25881724692863,6.14215770102973,6.83203807212624,9.12859039960938,9.33462433515709,9.825395412633,10.175606594275,10.4708082137424,10.9973393823643,11.1105107690835,11.5477192244889,11.6411502140726,11.9401500513133,12.2330520695437,12.2356358911582,11.660167141156,11.3279393579515,10.7347455916731,10.3321861841194,10.0632103540402,9.4441525333997,9.13760793704432,8.50684540448971,7.87073436119289,6.25881724692863]}]],[[{"lng":[14.8513,15.0968876481819,15.4710600000001,15.4871480648501,15.9032466976643,15.6857405941478,15.3004411149797,15.2477311540418,13.97217,13.5403935075508,13.9566988460941,13.9544767595056,14.5957812842476,14.4957873877628,14.2135307145846,14.1813362972668,13.9953528174483,13.3187016130186,13.0839872575488,12.3020711605405,11.5278031755114,10.9895931331915,10.7010319352737,10.1148144873547,9.52492801274295,9.01493330245444,7.80467125817878,7.33074669763002,6.82044192874775,6.44542605960564,5.44305830244013,4.36834354006601,4.10794599774732,3.96728274904885,3.68063357912581,3.61118045412556,2.84864301922658,2.49016360841793,2.15447350424992,2.17710778159378,1.02410322429748,0.993045688490071,0.429927605805518,0.295646396495101,0.374892205414682,1.01578331869848,1.38552819174686,2.74999270998148,3.63825890464648,3.72342166506348,4.2702099951438,4.26741946780004,5.67756595218069,8.57289310062978,11.9995056494716,13.5814245947905,14.1438708838552,14.8513],"lat":[22.8629500000001,21.3085187850749,21.0484500000001,20.7304145370256,20.3876189234175,19.9571800806424,17.927949937405,16.6273058130508,15.6843700000001,14.3671336939012,13.9966911890169,13.3534487980638,13.3304269474779,12.8593962671373,12.8020354272933,12.4836569279431,12.4615652531383,13.5563563094578,13.5961471623225,13.0371890324375,13.3289800073736,13.3873226994312,13.2469178328941,13.2772518986494,12.8511021997545,12.8266592472804,13.3435269230637,13.0980380314612,13.1150912541175,13.4927684595227,13.8659239771022,13.7474815942894,13.5312157251478,12.9561087101716,12.5529033472142,11.660167141156,12.2356358911582,12.2330520695437,11.9401500513133,12.6250178084775,12.8518256698066,13.3357496200038,13.9887330184439,14.4442349308807,14.9289081893461,14.968182277888,15.3235611027592,15.4095248478767,15.5681198185805,16.1842837590126,16.8522274846012,19.155265204337,19.6012069767997,21.5656607121591,23.4716684025964,23.0405060897693,22.4912889673711,22.8629500000001]}]],[[{"lng":[2.69170169435625,2.74906253420022,2.72379275880951,2.91230838381026,3.2203515967021,3.70543826662592,3.6000700211828,3.79711225751171,3.57221642417747,3.61118045412556,3.68063357912581,3.96728274904885,4.10794599774732,4.36834354006601,5.44305830244013,6.44542605960564,6.82044192874775,7.33074669763002,7.80467125817878,9.01493330245444,9.52492801274295,10.1148144873547,10.7010319352737,10.9895931331915,11.5278031755114,12.3020711605405,13.0839872575488,13.3187016130186,13.9953528174483,14.1813362972668,14.5771777686225,14.468192172919,14.4153788591167,13.5729496598946,13.3086763851539,13.1675997249971,12.955467970439,12.7536715023392,12.2188721045506,12.0639461605396,11.8393087093668,11.7457743669185,11.0587878760303,10.4973751156114,10.1182768083183,9.5227059261544,9.23316287602305,8.75753299320863,8.50028771325969,7.46210818851594,7.08259646976444,6.6980721370806,5.89817264163469,5.36280480309088,5.03357425295937,4.32560713056068,3.57418012860455,2.69170169435625],"lat":[6.25881724692863,7.87073436119289,8.50684540448971,9.13760793704432,9.4441525333997,10.0632103540402,10.3321861841194,10.7347455916731,11.3279393579515,11.660167141156,12.5529033472142,12.9561087101716,13.5312157251478,13.7474815942894,13.8659239771022,13.4927684595227,13.1150912541175,13.0980380314612,13.3435269230637,12.8266592472804,12.8511021997545,13.2772518986494,13.2469178328941,13.3873226994312,13.3289800073736,13.0371890324375,13.5961471623225,13.5563563094578,12.4615652531383,12.4836569279431,12.0853608260535,11.9047516951934,11.5723688826921,10.7985659855536,10.1603620467489,9.64062632897341,9.4177717147147,8.71776276288899,8.30582408287432,7.7998084578723,7.39704234458943,6.98138296144975,6.6444267846906,7.05535777427556,7.03876963950988,6.45348236737212,6.44449066815333,5.47966583904791,4.77198293702685,4.41210826254624,4.46468903240323,4.24059418376952,4.26245331462898,4.88797068930596,5.61180247641823,6.27065114992347,6.25830048260572,6.25881724692863]}]],[[{"lng":[14.4957873877628,14.89336,14.9601518083376,14.923564894275,15.4678727556052,14.9093538753947,14.6272005550811,14.171466098699,13.954218377344,14.5444665869818,14.9799955583377,15.1208655127653,15.4360917497457,15.2794604834691,14.7765454444046,14.5365600928411,14.4594071794293,14.5589359880235,14.4783724300805,14.9509534033897,15.0362195166712,15.4053959489644,15.8627323747475,15.9073808122476,16.0128524105554,15.9409188168051,15.1463419938852,14.3378125342466,13.0758223812467,12.9513338558556,12.3593803239522,11.7516654801998,11.2764490088437,9.64915815597263,9.79519575362946,9.404366896206,8.94811567550107,8.74492394372942,8.48881554529089,8.50028771325969,8.75753299320863,9.23316287602305,9.5227059261544,10.1182768083183,10.4973751156114,11.0587878760303,11.7457743669185,11.8393087093668,12.0639461605396,12.2188721045506,12.7536715023392,12.955467970439,13.1675997249971,13.3086763851539,13.5729496598946,14.4153788591167,14.468192172919,14.5771777686225,14.1813362972668,14.2135307145846,14.4957873877628],"lat":[12.8593962671373,12.21905,11.5555740421972,10.8913251815175,9.98233673750354,9.99212942142273,9.92091929772454,10.0213782820999,9.54949494062669,8.96586131432227,8.79610423424347,8.38215017336944,7.69281240481189,7.42192454673797,6.40849803306205,6.22695872642069,5.4517605656103,5.03059764243153,4.73260549562045,4.21038930909492,3.85136729574712,3.33530060466434,3.01353729899898,2.55738943115861,2.26763967529808,1.7276726342803,1.96401479736718,2.22787466064949,2.26709707275901,2.32161570882694,2.19281220133945,2.32675751383999,2.26105093018087,2.28386607503774,3.07340444580912,3.7345268823352,3.90412893311714,4.35221527751996,4.49561737712992,4.77198293702685,5.47966583904791,6.44449066815333,6.45348236737212,7.03876963950988,7.05535777427556,6.6444267846906,6.98138296144975,7.39704234458943,7.7998084578723,8.30582408287432,8.71776276288899,9.4177717147147,9.64062632897341,10.1603620467489,10.7985659855536,11.5723688826921,11.9047516951934,12.0853608260535,12.4836569279431,12.8020354272933,12.8593962671373]}]],[[{"lng":[0.899563022474068,0.772335646171484,1.07779503744874,1.42506066245014,1.46304284018467,1.66447757325838,1.61895063640924,1.86524051271232,1.06012169760493,0.836931186536333,0.570384148774849,0.490957472342245,0.712029249686878,0.461191847342121,0.365900506195885,0.367579990245389,-0.0497847151599438,0.0238025244237006,0.899563022474068],"lat":[10.9973393823643,10.4708082137424,10.175606594275,9.825395412633,9.33462433515709,9.12859039960938,6.83203807212624,6.14215770102973,5.92883738852888,6.27997874595215,6.91435862876719,7.41174428957647,8.31246450442383,8.67722260175602,9.46500397382948,10.1912128768272,10.7069178328839,11.0186817489008,10.9973393823643]}]],[[{"lng":[0.0238025244237006,-0.0497847151599438,0.367579990245389,0.365900506195885,0.461191847342121,0.712029249686878,0.490957472342245,0.570384148774849,0.836931186536333,1.06012169760493,-0.507637905265937,-1.06362464029419,-1.96470659016759,-2.8561250472024,-2.81070146321784,-3.24437008301126,-2.98358496745033,-2.56218950032624,-2.82749630371271,-2.96389624674711,-2.94040930827046,-1.20335771321143,-0.761575893548184,-0.438701544588582,0.0238025244237006],"lat":[11.0186817489008,10.7069178328839,10.1912128768272,9.46500397382948,8.67722260175602,8.31246450442383,7.41174428957647,6.91435862876719,6.27997874595215,5.92883738852888,5.34347260174267,5.00054779705381,4.71046214438337,4.99447581625951,5.38905121502411,6.2504715031135,7.37970490155551,8.21962779381148,9.64246084231978,10.3953347843801,10.9626903345126,11.0098192407627,10.9369296330151,11.0983409692787,11.0186817489008]}]],[[{"lng":[-8.02994361004862,-7.89958980959237,-7.62275916180481,-6.85050655763506,-6.66646094402755,-6.49396501303727,-6.20522294760643,-6.05045203289227,-5.81692623536529,-5.40434159994697,-4.9546532861431,-4.77988359213197,-4.33024695476038,-3.98044918457668,-3.51189897298627,-2.82749630371271,-2.56218950032624,-2.98358496745033,-3.24437008301126,-2.81070146321784,-2.8561250472024,-3.31108435710007,-4.00881954590494,-4.64991736491791,-5.83449622234453,-6.52876909018585,-7.51894120933044,-7.71215938966975,-7.63536821128403,-7.53971513511176,-7.57015255373169,-7.99369259279588,-8.31134762209402,-8.60288021486862,-8.38545162600057,-8.48544552248535,-8.4392984684487,-8.28070349774494,-8.2217923649322,-8.29904863120857,-8.20349890790088,-7.83210038901919,-8.07911373537435,-8.30961646161225,-8.22933712404682,-8.02994361004862],"lat":[10.2065349390017,10.2973821069708,10.1472362329468,10.1389938419962,10.4308106551484,10.4113028019583,10.5240607772191,10.0963607853554,10.2225546330122,10.3707368026091,10.1527139347697,9.82198476810174,9.61083486575714,9.8623440617217,9.90032623945622,9.64246084231978,8.21962779381148,7.37970490155551,6.2504715031135,5.38905121502411,4.99447581625951,4.98429555909801,5.17981334067431,5.16826365805708,4.99370066977514,4.70508779542502,4.33828847901731,4.36456594483772,5.18815908448946,5.31334524171652,5.7073521997259,6.12618968345154,6.19303314862108,6.46756419517166,6.91180064536874,7.39520783124307,7.68604279218174,7.68717967369215,8.12332876223557,8.3164435897103,8.45545319257545,8.57570425051863,9.37622386315203,9.78953196862244,10.1290202905639,10.2065349390017]}]],[[{"lng":[-13.7004760400843,-13.2178181624782,-12.4990506657306,-12.2785990055734,-12.2035648258856,-11.6583009505579,-11.5139428369506,-11.4561685856483,-11.2975736149445,-11.0365559554383,-10.8708296370782,-10.5932238428063,-10.1652137923488,-9.89099280439201,-9.56791174970321,-9.32761633954601,-9.12747351727958,-8.90526485842453,-8.78609900555946,-8.37630489748491,-8.58130530438677,-8.62032101076713,-8.40731075686003,-8.28235714357828,-8.33537716310974,-8.02994361004862,-8.22933712404682,-8.30961646161225,-8.07911373537435,-7.83210038901919,-8.20349890790088,-8.29904863120857,-8.2217923649322,-8.28070349774494,-8.4392984684487,-8.72212358238212,-8.926064622422,-9.20878638349084,-9.40334815106975,-9.33727983238458,-9.75534216962583,-10.0165665348613,-10.2300935530913,-10.5054772607747,-10.4943151513996,-10.6547704736659,-10.622395188835,-10.8391519840833,-11.1174812484073,-11.9172773909887,-12.150338100625,-12.4259285140376,-12.5967191227622,-12.7119575667731,-13.2465502588325,-13.6851539779098,-14.0740449691223,-14.3300758529124,-14.5796988590983,-14.6932319808435,-14.8395537988779,-15.1303112451682,-14.6856872217289,-14.3821915348787,-14.1214064193178,-13.9007997298638,-13.7431607731574,-13.8282718571421,-13.7187436588995,-13.7004760400843],"lat":[12.5861829696102,12.575873521368,12.3320899520311,12.3544400089973,12.4656476912894,12.3865827498828,12.4429875757294,12.0768342147253,12.0779710962358,12.2112446151165,12.1778874780721,11.923975328006,11.8440835636827,12.060478623905,12.1942430688925,12.3342862004035,12.3080604110153,12.0883580591264,11.8125609399847,11.3936459416106,11.1362456323648,10.8108908146552,10.9092569035228,10.7925973576238,10.4948119165419,10.2065349390017,10.1290202905639,9.78953196862244,9.37622386315203,8.57570425051863,8.45545319257545,8.3164435897103,8.12332876223557,7.68717967369215,7.68604279218174,7.71167430259851,7.30903738039637,7.31392080324795,7.5269052189389,7.92853445071135,8.54105520266693,8.42850393313523,8.40620555260129,8.3488963891896,8.71554067630043,8.9771784529942,9.26791006106828,9.68824616133037,10.0458729110063,10.0469839543006,9.85857168216438,9.83583405195596,9.62018830000197,9.34271169681077,8.90304861087151,9.49474376061346,9.88616689700825,10.015719712764,10.2144672713585,10.656300767454,10.8765715600981,11.0404116886795,11.5278237980565,11.5092719588637,11.6771170109477,11.6787189803487,11.8112690291774,12.142644151249,12.2471855737755,12.5861829696102]}]],[[{"lng":[-8.4392984684487,-8.48544552248535,-8.38545162600057,-8.60288021486862,-8.31134762209402,-7.99369259279588,-7.57015255373169,-7.53971513511176,-7.63536821128403,-7.71215938966975,-7.97410722495725,-9.00479366701867,-9.91342037600668,-10.7653838769866,-11.4387794661821,-11.1998018050483,-11.1467042708684,-10.6955948551765,-10.2300935530913,-10.0165665348613,-9.75534216962583,-9.33727983238458,-9.40334815106975,-9.20878638349084,-8.926064622422,-8.72212358238212,-8.4392984684487],"lat":[7.68604279218174,7.39520783124307,6.91180064536874,6.46756419517166,6.19303314862108,6.12618968345154,5.7073521997259,5.31334524171652,5.18815908448946,4.36456594483772,4.35575511313196,4.8324185245922,5.59356069581921,6.14071076092556,6.78591685630575,7.10584564862473,7.39670644777954,7.93946401614108,8.40620555260129,8.42850393313523,8.54105520266693,7.92853445071135,7.5269052189389,7.31392080324795,7.30903738039637,7.71167430259851,7.68604279218174]}]],[[{"lng":[-13.2465502588325,-12.7119575667731,-12.5967191227622,-12.4259285140376,-12.150338100625,-11.9172773909887,-11.1174812484073,-10.8391519840833,-10.622395188835,-10.6547704736659,-10.4943151513996,-10.5054772607747,-10.2300935530913,-10.6955948551765,-11.1467042708684,-11.1998018050483,-11.4387794661821,-11.7081945459357,-12.4280989241938,-12.9490490381282,-13.1240254378685,-13.2465502588325],"lat":[8.90304861087151,9.34271169681077,9.62018830000197,9.83583405195596,9.85857168216438,10.0469839543006,10.0458729110063,9.68824616133037,9.26791006106828,8.9771784529942,8.71554067630043,8.3488963891896,8.40620555260129,7.93946401614108,7.39670644777954,7.10584564862473,6.78591685630575,6.86009837486073,7.26294200279203,7.79864573814574,8.16394643801698,8.90304861087151]}]],[[{"lng":[-5.40434159994697,-5.47056494792901,-5.19784257650865,-5.22094194174312,-4.4271661035238,-4.28040503581488,-4.00639075358723,-3.52280270019986,-3.10370683431276,-2.96769446452058,-2.19182451009039,-2.00103512206877,-1.06636349120566,-0.515854458000348,-0.266257290030581,0.374892205414682,0.295646396495101,0.429927605805518,0.993045688490071,1.02410322429748,2.17710778159378,2.15447350424992,1.93598554851988,1.44717817547107,1.24346967937649,0.899563022474068,0.0238025244237006,-0.438701544588582,-0.761575893548184,-1.20335771321143,-2.94040930827046,-2.96389624674711,-2.82749630371271,-3.51189897298627,-3.98044918457668,-4.33024695476038,-4.77988359213197,-4.9546532861431,-5.40434159994697],"lat":[10.3707368026091,10.951269842976,11.3751457788501,11.7138589543072,12.5426455754043,13.2284435083497,13.4724854598481,13.3376616479986,13.5412667912286,13.7981503361515,14.2464175480674,14.5590082870009,14.9738150090078,15.1161577417557,14.9243089868721,14.9289081893461,14.4442349308807,13.9887330184439,13.3357496200038,12.8518256698066,12.6250178084775,11.9401500513133,11.6411502140726,11.5477192244889,11.1105107690835,10.9973393823643,11.0186817489008,11.0983409692787,10.9369296330151,11.0098192407627,10.9626903345126,10.3953347843801,9.64246084231978,9.90032623945622,9.8623440617217,9.61083486575714,9.82198476810174,10.1527139347697,10.3707368026091]}]],[[{"lng":[27.3742261085175,27.0440653826047,26.4027608578625,25.6504553565575,25.2787984555143,25.1288334490033,24.8050289242624,24.4105310401463,23.2972139828501,22.8414795264681,22.7041235694363,22.4051237321955,21.65912275563,20.9275911801063,20.2906791521089,19.4677836442931,18.9323124528848,18.5429822119978,18.4530652198099,17.8099003435053,17.1330424333463,16.5370581397241,16.0128524105554,15.9073808122476,15.8627323747475,15.4053959489644,15.0362195166712,14.9509534033897,14.4783724300805,14.5589359880235,14.4594071794293,14.5365600928411,14.7765454444046,15.2794604834691,16.1062317237067,16.2905615576919,16.4561845231873,16.7059883968863,17.9649296403809,18.3895548845232,18.9110217627805,18.8120097185093,19.094008009526,20.0596854997643,21.0008683610962,21.7238216488595,22.2311291846688,22.8641654802442,22.9775435726926,23.5543042335022,23.5572497901428,23.3947790870172,23.459012892356,23.8058134294667,24.5673690121521,25.1149324887168,25.1241308936647,25.7966479835112,26.2134184099451,26.4659094581232,27.2134090512252,27.3742261085175],"lat":[5.23394440350006,5.12785268800484,5.15087453859087,5.25608775473712,5.17040822999719,4.92724477784779,4.89724660890235,5.10878408448913,4.60969310141422,4.71012624757349,4.63305084881016,4.02916006104732,4.22434194581372,4.32278554932974,4.69167776124529,5.03152781821278,4.70950613038598,4.20178518311832,3.50438589112335,3.56019643799857,3.72819651937945,3.19825470622628,2.26763967529808,2.55738943115861,3.01353729899898,3.33530060466434,3.85136729574712,4.21038930909492,4.73260549562045,5.03059764243153,5.4517605656103,6.22695872642069,6.40849803306205,7.42192454673797,7.49708791750646,7.75430735923942,7.73477366783297,7.50832754152998,7.89091400800299,8.28130361575182,8.63089468020635,8.9829145369786,9.07484691002584,9.01270600019485,9.47598521569151,10.567055568886,10.9718887394606,11.1423951278075,10.7144625919985,10.0892552759153,9.68121816653868,9.26506785729222,8.95428579348889,8.66631887454253,8.22918793378547,7.82510407147917,7.50008515057943,6.97931590415807,6.54660329836207,5.94671743410187,5.55095347739456,5.23394440350006]}]],[[{"lng":[18.4530652198099,18.3937923519711,18.0942757504074,17.8988354834796,17.7741919287916,17.8265401547032,17.6635526872547,17.63864464689,17.5237162614729,16.8653068376421,16.4070919125101,15.9728031755292,16.0062895036543,15.7535400733147,15.1709916520884,14.5826037940132,14.2090348649752,14.1449560889333,13.6002348161447,13.258240187237,12.9955172054652,12.6207597184845,12.3186076188739,11.9149630062421,11.0937728206919,11.8551216976481,11.4780387712143,11.8209635759032,12.4957027523382,12.5752844580676,13.1096187679656,13.9924072608077,14.2992102393246,14.4254557634136,14.3164184912777,13.8433207536457,14.276265903387,14.0266687354172,13.2826314632788,13.0031136410121,13.0758223812467,14.3378125342466,15.1463419938852,15.9409188168051,16.0128524105554,16.5370581397241,17.1330424333463,17.8099003435053,18.4530652198099],"lat":[3.50438589112335,2.90044342692822,2.36572154378806,1.74183197672828,0.855658677571085,0.288923244626105,-0.0580839982138172,-0.424831638189247,-0.743830254726987,-1.22581633871329,-1.74092701579868,-2.71239226645361,-3.53513274497253,-3.8551648901561,-4.3435071753143,-4.97023894615014,-4.7930921362536,-4.51000864015872,-4.50013844159097,-4.88295745200917,-4.78110320396188,-4.43802336997614,-4.60623015708619,-5.03798674888479,-3.97882659263055,-3.42687061932105,-2.76561899171424,-2.51416147218198,-2.39168832765024,-1.94851124431513,-2.42874032960351,-2.4708049454891,-1.99827564861221,-1.33340667074497,-0.552627455247048,0.038757635901149,1.19692983642662,1.39567739502115,1.31418366129688,1.83089630778332,2.26709707275901,2.22787466064949,1.96401479736718,1.7276726342803,2.26763967529808,3.19825470622628,3.72819651937945,3.56019643799857,3.50438589112335]}]],[[{"lng":[11.2764490088437,11.7516654801998,12.3593803239522,12.9513338558556,13.0758223812467,13.0031136410121,13.2826314632788,14.0266687354172,14.276265903387,13.8433207536457,14.3164184912777,14.4254557634136,14.2992102393246,13.9924072608077,13.1096187679656,12.5752844580676,12.4957027523382,11.8209635759032,11.4780387712143,11.8551216976481,11.0937728206919,10.0661352881357,9.40524539555497,8.79799563969317,8.83008670414642,9.04841963057959,9.29135053878369,9.49288862472199,9.83028405115564,11.2850789730365,11.2764490088437],"lat":[2.26105093018087,2.32675751383999,2.19281220133945,2.32161570882694,2.26709707275901,1.83089630778332,1.31418366129688,1.39567739502115,1.19692983642662,0.038757635901149,-0.552627455247048,-1.33340667074497,-1.99827564861221,-2.4708049454891,-2.42874032960351,-1.94851124431513,-2.39168832765024,-2.51416147218198,-2.76561899171424,-3.42687061932105,-3.97882659263055,-2.96948251710568,-2.14431324626904,-1.1113013647545,-0.779073581550037,-0.459351494960217,0.268666083167687,1.01011953369149,1.0678937849938,1.05766185140001,2.26105093018087]}]],[[{"lng":[9.64915815597263,11.2764490088437,11.2850789730365,9.83028405115564,9.49288862472199,9.30561323409626,9.64915815597263],"lat":[2.28386607503774,2.26105093018087,1.05766185140001,1.0678937849938,1.01011953369149,1.16091136311918,2.28386607503774]}]],[[{"lng":[12.9955172054652,12.6316117692658,12.4680041846297,12.4366882666609,12.1823368669202,11.9149630062421,12.3186076188739,12.6207597184845,12.9955172054652],"lat":[-4.78110320396188,-4.99127125409294,-5.248361504745,-5.68430388755925,-5.78993051516384,-5.03798674888479,-4.60623015708619,-4.43802336997614,-4.78110320396188]}],[{"lng":[12.3224316748635,12.7351713395787,13.024869419007,13.3755973649719,16.326528354567,16.5731799658961,16.8601908708452,17.0899959652472,17.4729700049622,18.134221632569,18.4641756527527,19.0167517432497,19.1666133968961,19.4175024756732,20.0377230160402,20.0916215349206,20.6018229509383,20.5147481625265,21.7281107927397,21.7464559262033,21.949130893652,21.8018013851879,21.8751819190423,22.2087532894864,22.1552681820643,22.4027982927424,22.8373454118847,23.4567908057674,23.9122152035557,24.0178935075926,23.9041536801182,24.0799052263428,23.9309220720454,24.0161365088947,21.9338863461259,21.8878426449539,22.5624784685243,23.2150484555061,21.3771761410456,18.9561869646036,18.2633093604342,14.209706658595,14.058501417709,13.46236209479,12.8140812516884,12.2154614600194,11.7341988460851,11.6400960628816,11.7785372249915,12.1235807634044,12.1756189307223,12.500095249083,12.7384786312454,13.3129138526019,13.6337211442698,13.7387276546869,13.6863794287752,13.3873279151022,13.1209875830698,12.8753695003866,12.9290613135378,13.2364327328099,12.9330403988243,12.7282983740839,12.2273470394465,12.3224316748635],"lat":[-6.10009246177966,-5.9656820613885,-5.98438892987816,-5.86424122479955,-5.87747039146627,-6.62264454511509,-7.22229786542998,-7.54568897871252,-8.0685511206417,-7.98767750410492,-7.84701425540644,-7.98824594486013,-7.73818368899975,-7.1554285620443,-7.11636117923164,-6.94309010175699,-6.93931772219968,-7.29960580813863,-7.2908724910813,-7.92008473066715,-8.30590097415828,-8.90870655684298,-9.52370777754856,-9.89479623783651,-11.0848011206538,-10.9930754533357,-11.0176217586743,-10.8678634578925,-10.9268262671375,-11.2372982723471,-11.7222815894063,-12.1912968888874,-12.5658476701389,-12.9110462378486,-12.8984371883694,-16.0803101538769,-16.8984514299218,-17.523116143466,-17.9306364885197,-17.7890947404723,-17.309950860262,-17.3531006812257,-17.4233806291427,-16.9712118465888,-16.9413428687241,-17.1116683895581,-17.3018893368245,-16.6731421851293,-15.7938160132507,-14.8783163387679,-14.4491435685839,-13.5476998836844,-13.1379057756099,-12.4836304663625,-12.0386447078972,-11.2978630509932,-10.7310759416159,-10.3735783830207,-9.76689706791412,-9.16693368900547,-8.95909107832755,-8.5626294897843,-7.59653858808773,-6.9271220841788,-6.29444752362939,-6.10009246177966]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolygons","args":[[[[{"lng":[17.5184567465688,17.4979463149489,17.4364039910231,17.3337977108381,17.1900774458811,17.0051803213695,16.7790377809988,16.5115847898044,16.2027710537768,15.8525742140075,15.4610149429343,15.028173829454,14.5542098874269,14.0393804581623,13.4840622023851,12.8887727925329,12.2541928248609,11.5811873770325,10.8708265464833,10.1244042251861,9.34345430607713,8.5297634846462,7.68537982533117,6.8126163146712,5.91404872770038,4.99250729339447,4.05106185711198,3.0930004955443,2.12180182979352,1.14110158688147,0.154654257591073,-0.833709034293845,-1.82012512203558,-2.80074437357216,-3.77177572749118,-4.7295296907734,-5.67045792156146,-6.59118821621308,-7.48855397457884,-8.35961750905471,-9.20168686814222,-10.0123261416611,-10.7893594832712,-11.5308693121944,-12.2351893310873,-12.900893117487,-13.526779113542,-14.1118528580566,-14.6553072839955,-15.1565018526048,-15.6149412215941,-16.0302540581813,-16.4021725158957,-16.7305128030788,-17.0151571856601,-17.2560376901909,-17.4531217070871,-17.606399639274,-17.7158746977209,-17.7815549118369,-17.8034473979917,-17.7815549118369,-17.7158746977209,-17.606399639274,-17.4531217070871,-17.2560376901909,-17.0151571856602,-16.7305128030789,-16.4021725158958,-16.0302540581814,-15.6149412215942,-15.1565018526049,-14.6553072839956,-14.1118528580568,-13.5267791135422,-12.9008931174872,-12.2351893310874,-11.5308693121946,-10.7893594832714,-10.0123261416613,-9.20168686814241,-8.3596175090549,-7.48855397457904,-6.59118821621327,-5.67045792156165,-4.72952969077358,-3.77177572749136,-2.80074437357233,-1.82012512203575,-0.833709034294005,0.154654257590921,1.14110158688133,2.12180182979338,3.09300049554418,4.05106185711186,4.99250729339436,5.91404872770028,6.81261631467112,7.6853798253311,8.52976348464613,9.34345430607707,10.124404225186,10.8708265464833,11.5811873770325,12.2541928248609,12.8887727925329,13.4840622023851,14.0393804581623,14.5542098874269,15.028173829454,15.4610149429343,15.8525742140075,16.2027710537768,16.5115847898044,16.7790377809988,17.0051803213695,17.1900774458811,17.3337977108381,17.4364039910231,17.4979463149489,17.5184567465688],"lat":[0,-0.886631385898722,-1.77160299099697,-2.65324523266625,-3.52986913130789,-4.39975713077677,-5.26115454738797,-6.11226186609552,-6.95122810867736,-7.77614550465261,-8.58504569991791,-9.37589773919632,-10.1466080546124,-10.8950226821525,-11.6189319084782,-12.3160775206282,-12.9841627888639,-13.6208652570102,-14.2238523444683,-14.7907996798796,-15.3194119895949,-15.8074462573603,-16.2527367591503,-16.6532214644706,-17.0069691895934,-17.3122067968475,-17.5673456653398,-17.7710066199907,-17.9220425038942,-18.0195576180068,-18.0629233333953,-18.0517893027517,-17.986089854138,-17.8660453322813,-17.6921583500227,-17.4652051120932,-17.1862221623858,-16.8564890725182,-16.477507724117,-16.0509789332743,-15.5787772198608,-15.0629245370438,-14.505563750766,-13.9089326007509,-13.2753387910725,-12.6071367573885,-11.9067065474633,-11.1764351387556,-10.4187004076137,-9.6358578636434,-8.83023017324631,-8.00409941998189,-7.15970198688126,-6.29922589678105,-5.42481041007154,-4.53854765341281,-3.64248603614569,-2.73863520140227,-1.82897225444442,-0.915449009816306,-1.18648117821771e-13,0.915449009816069,1.82897225444418,2.73863520140204,3.64248603614545,4.53854765341258,5.42481041007131,6.29922589678082,7.15970198688103,8.00409941998167,8.8302301732461,9.63585786364319,10.4187004076135,11.1764351387554,11.9067065474632,12.6071367573883,13.2753387910724,13.9089326007507,14.5055637507659,15.0629245370437,15.5787772198607,16.0509789332742,16.4775077241169,16.8564890725182,17.1862221623857,17.4652051120932,17.6921583500227,17.8660453322813,17.986089854138,18.0517893027517,18.0629233333953,18.0195576180068,17.9220425038942,17.7710066199907,17.5673456653398,17.3122067968475,17.0069691895934,16.6532214644707,16.2527367591504,15.8074462573604,15.3194119895949,14.7907996798796,14.2238523444683,13.6208652570102,12.9841627888639,12.3160775206283,11.6189319084782,10.8950226821525,10.1466080546124,9.37589773919632,8.58504569991791,7.77614550465261,6.95122810867735,6.1122618660955,5.26115454738794,4.39975713077674,3.52986913130785,2.65324523266622,1.77160299099692,0.886631385898672,0]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-18.0629233333953,27.395744126896],"lng":[-17.8034473979917,31.1741492042358]}},"evals":[],"jsHooks":[]}</script><p class="caption">
Subset of the <code>africa</code> data selected based on their intersection with a circle 2000 km in radius with a center point at 0 degrees longitude and 0 degrees latitude.
</p>
</div>
<p>Note that countries that just touch the giant circle are selected such as Chad (northeast of the circle). This is because the default subsetting operator is <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_intersects()</a></code>, which returns any type of spatial relation. Other spatial subsetting operations such as <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_within()</a></code> are more conservative, as shown in <a href="https://geocompr.robinlovelace.net/spatial-operations.html#topological-relations">the topological relations section</a>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">buff_agg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/aggregate.sf">aggregate</a></span>(<span class="dt">x =</span> africa[, <span class="st">"pop"</span>], <span class="dt">by =</span> buff, <span class="dt">FUN =</span> sum)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">buff_agg</a></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 1 field
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -1166021 ymin: -2e+06 xmax: 2833979 ymax: 2e+06
## epsg (SRID):    32630
## proj4string:    +proj=utm +zone=30 +datum=WGS84 +units=m +no_defs
##         pop                       geometry
## 1 487896821 POLYGON ((2833979 0, 283123...</code></pre>
<!--
show also tidyverse way, so what you are doing is basically a spatial join and a subsequent aggregation without a grouping variable. Didactically, it might be better to present a grouping variable.
-->
<p>The result, <code>buff_agg</code>, is a spatial object with the same geometry as <code>by</code> (the circular buffer in this case) but with an additional variable, <code>pop</code> reporting summary statistics for all features in <code>x</code> that intersect with <code>by</code> (the total population of the countries that touch the buffer in this case). Plotting the result (with <code><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot(buff_agg)</a></code>) shows that the operation does not really make sense: The figure below shows a population of over half a billion people mostly located in a giant circle floating off the west coast of Africa!</p>
<div class="figure">
<img src="subsetting_files/figure-html/buff-agg-1.png" alt="Result of spatial aggregation showing the total population of countries that intersect with a large circle whose center lies at 0 degrees longitude and latitude." width="700"><p class="caption">
Result of spatial aggregation showing the total population of countries that intersect with a large circle whose center lies at 0 degrees longitude and latitude.
</p>
</div>
<p>The results of the spatial aggregation exercise presented in this figure are unrealistic for three reasons:</p>
<ul>
<li>People do not live in the sea (the geometry of the aggregating object is not appropriate for the geometry target object).</li>
<li>This method would ‘double count’ countries whose borders cross aggregating polygons when multiple, spatially contiguous, features are used as the aggregating object.</li>
<li>It is wrong to assume that all the people living in countries that <em>touch</em> the buffer reside <em>within</em> it (the default spatial operator <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_pred">st_intersects()</a></code> is too ‘greedy’). The most extreme example of this is Algeria, the most northerly country selected: the spatial aggregation operation assumes that all 39 million Algerian citizens reside in the tiny southerly tip that is within the circular buffer.</li>
</ul>
<p>A number of methods can be used to overcome these issues, and generate a more realistic population attributed to the circular buffer illustrated in the above figure. The simplest of these is to convert the country polygons into points representing their <em>geographic centroids</em> before aggregation. <!-- Todo: reference section where we demonstrate geographic centroid generation --> This would ensure that any spatially contiguous aggregating object covering the target object (the Earth in this case) would result in the same total: there would be no double counting. The estimated total population residing within the study area would be more realistic if geographic centroids were used. (The centroid of Algeria, for example, is far outside the aggregating buffer.)</p>
<p>Except in cases where the number of target features per aggregating feature is very large, or where the aggregating object is <em>spatially congruent</em> with the target, using centroids can also lead to errors due to boundary effects: imagine a buffer that covers a large area but contains no centroids. These issues can be tackled when aggregating areal target data with areal interpolation.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Recall attribute subsetting can also be done in base R with <code>africa_wgs = world[world$continent == "Africa", ]</code>.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#subsetting-with-intermediary-objects">Subsetting with intermediary objects</a></li>
      <li><a href="#dplyr-changes-row-names"><strong>dplyr</strong> changes row names</a></li>
      <li><a href="#dense-matrices-from-spatial-predicates">Dense matrices from spatial predicates</a></li>
      <li><a href="#more-on-subsetting-in-base-r">More on subsetting in base R</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Jakub Nowosad, Jannes Muenchow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
